<div class="container">
  <div class="jumbotron">
    <h1>Fixed Deposit</h1> 
  </div>
  

 <div id="myCarousel" class="carousel slide" data-ride="carousel">
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
    <li data-target="#myCarousel" data-slide-to="1"></li>
    <li data-target="#myCarousel" data-slide-to="2"></li>
    <li data-target="#myCarousel" data-slide-to="3"></li>
  </ol>

  <!-- Wrapper for slides -->
  <div class="carousel-inner" role="listbox">
    <div class="item active">
      <%= image_tag("FD1.JPG") %>
    </div>

    <div class="item">
      <%= image_tag("FD2.JPG") %>
    </div>

    <div class="item">
      <%= image_tag("FD3.JPG") %>
    </div>

  </div>

  <!-- Left and right controls -->
  <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
 </div>

 <div class="container-fluid">
  <div class="text-center">
    <h2><strong>Decide your FD.</strong></h2>
  </div>


 <div class="row slideanim">
   <div class="col-sm-4 col-xs-12">
     <div class="panel panel-default text-center">
        <div class="jumbotron">
   			<h1>3 Months</h1> 
  		</div>
  		<h2 id="3months"><%= "Rate : #{@initial_fixed_deposit_rates[0]}%" %></h2>
     </div>
   </div>


  
   <div class="col-sm-4 col-xs-12">
     <div class="panel panel-default text-center">
        <div class="jumbotron">
   			<h1>6 Months</h1> 
  		</div>
  		<h2 id="6months"><%= "Rate : #{@initial_fixed_deposit_rates[1]}%" %></h2>
     </div>
   </div>


 
   <div class="col-sm-4 col-xs-12">
     <div class="panel panel-default text-center">
        <div class="jumbotron">
   			<h1>9 Months</h1> 
  		</div>
  		<h2 id="9months"><%= "Rate : #{@initial_fixed_deposit_rates[2]}%" %></h2>
     </div>
   </div>
 </div>

 <div id="status">
   <p>Current Balance : <span id="start_balance"><%= current_user_active_profile.current_balance %></span></p>
   <p>Amount Placed : <span id="amount_placed">0</span></p>
   <p>Profit Earned : <span id="profit">0</span></p>
 </div>

	<div class="form-group">
       <input type="number" min="1" max="<%= current_user_active_profile.current_balance %>" autocomplete="off" placeholder="0.00"/>
       <button id="start" class="btn btn-primary">Place Deposit</button>
        <button id="stop" class="btn btn-danger">Uplift Deposit</button>
  </div>

  <div class="progress-wrapper">
    <div class="progress progress-striped">
      <div class="progress-bar progress-bar-success" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
  </div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){

    var progress = null;
    var progressbar = 0;

    $('start').attr('disabled', 'true');
    $('#stop').attr('disabled', 'true');
    $('input').removeAttr('disabled');

    $('input').on('input change', function(){
      $startBalance = $('#start_balance').text();
      $placementAmount = $('input').val();
      if ($placementAmount > Number($startBalance) || $placementAmount == 0){
        $('#start').attr('disabled', 'true');
      }else{
        $('#start').removeAttr('disabled');
      }
    });
      
    

    $('#start').click(function(){

      $('#stop').removeAttr('disabled');
      $('#start').attr('disabled', 'true');
      $('input').attr('disabled', 'true');

      $startBalance = $('#start_balance').text();
      $placementAmount = $('input').val();
      $updateStartBalance = $startBalance - $placementAmount;
      $('#start_balance').text($updateStartBalance);
      $('#end_balance').text($updateStartBalance);
      $('#amount_placed').text($placementAmount);
      progress = setInterval(function(){
        progressbar += 1;
        $('.progress-bar').attr("style", "width:"+progressbar+"%")
        $('.progress-bar').text(progressbar+"%")
        if (progressbar >= 100){
          $('#stop').removeClass("btn-danger")
          $('#stop').addClass("btn-success")
          clearInterval(progress);
          var profit = $placementAmount * 2
          $('#profit').text(profit)
          
          $.ajax({
            method: "post",
            url: "/refresh_fd_rates",
            beforeSend: function(xhr){xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
            dataType: "json",
            success: function(data){
              $('#3months').text("Rate : "+data[0]+"%");
              $('#6months').text("Rate : "+data[1]+"%");
              $('#9months').text("Rate : "+data[2]+"%");
            }
          });
        }
      },50)      

    });

    $('#stop').click(function(){
      clearInterval(progress);
      progressbar = 0;
      $startBalance = Number($('#start_balance').text());
      $profitEarned = Number($('#profit').text());
      var newBalance = $startBalance + $profitEarned;
      $('#start_balance').text(newBalance);
      $('#profit').text(0);
      $('#amount_placed').text(0);
      $('.progress-bar').text(progressbar+"%")
      $('.progress-bar').attr("style", "width:"+progressbar+"%")
      $('#start').removeAttr('disabled')
      $('input').removeAttr('disabled')
      $('#stop').attr('disabled', 'true')
      $('#stop').removeClass('btn-success')
      $('#stop').addClass('btn-danger')
    });


    



    
    
  });
</script>


    <br>
  

  <h3>
    <strong>Investment Overview:</strong><br>
    Funds available: RM <strong>1000</strong> <br>
    Interest gained at end of maturity: 1.8%<br>
    <br>

    <strong>Investment Summary:</strong><br>
    Total value of investment: RM <strong>1018</strong> <br>
    Annualized rate of return <strong>4.25%</strong> <br>
  </h3>


</div>